<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="WebSocket 第一部分：WebSocket API
二进制的类型 WebSocket的消息可以是文本或者二进制数据，可以设置接收二进制数据的格式：Blob、ArrayBuffer。
 Blob是不可变的文件对象，适合直接保存、传给img ArrayBuffer适合放在内存中进行操作  二进制数据可以用于传输文件、图片。普通消息用文本。
排队 发送消息前检查客户端缓冲的数据量。
if(ws.bufferedAmount === 0) { ws.send(message); } 消息按照客户端排队的顺序逐个发送，大量的消息甚至一个大消息，都会导致排在后面的消息延迟——队首阻塞！
子协议 通过使用子协议来沟通元数据，可以在JSON中定义一个字段，可以使用文本&#43;二进制。
WebSocket提供了协商子协议的API——构造函数的第二个参数。浏览器选择一个协议，如果一个不选就会断开连接。
第二部分：WebSocket协议
协议 HTTP握手协商连接参数，二进制消息分帧进行文本和二进制数据消息传输。
二进制分帧层 将一个消息分成若干帧，传输以帧为单位进行，发送到目的地后组成起来，等接收到完整的消息时再通知接收方。
容易发生队首阻塞，因为消息的帧不能交错发送，要等一个消息的帧发送完了才会发送下一个消息的帧。
不支持多路复用，每个WebSocket连接需要一个TCP连接。
HTTP升级协商  HTTP握手 Connection: Upgrade 跨域  性能 XHR轮询、SSE（EventSource协议）、WebSocket协议。
轮询有间隔时间，SSE客户端不能给服务端发消息，SSE和WebSocket都可以立即发消息。
实战 使用sockjs
使用stompjs
断线重连">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="WebSocket 第一部分：WebSocket API
二进制的类型 WebSocket的消息可以是文本或者二进制数据，可以设置接收二进制数据的格式：Blob、ArrayBuffer。
 Blob是不可变的文件对象，适合直接保存、传给img ArrayBuffer适合放在内存中进行操作  二进制数据可以用于传输文件、图片。普通消息用文本。
排队 发送消息前检查客户端缓冲的数据量。
if(ws.bufferedAmount === 0) { ws.send(message); } 消息按照客户端排队的顺序逐个发送，大量的消息甚至一个大消息，都会导致排在后面的消息延迟——队首阻塞！
子协议 通过使用子协议来沟通元数据，可以在JSON中定义一个字段，可以使用文本&#43;二进制。
WebSocket提供了协商子协议的API——构造函数的第二个参数。浏览器选择一个协议，如果一个不选就会断开连接。
第二部分：WebSocket协议
协议 HTTP握手协商连接参数，二进制消息分帧进行文本和二进制数据消息传输。
二进制分帧层 将一个消息分成若干帧，传输以帧为单位进行，发送到目的地后组成起来，等接收到完整的消息时再通知接收方。
容易发生队首阻塞，因为消息的帧不能交错发送，要等一个消息的帧发送完了才会发送下一个消息的帧。
不支持多路复用，每个WebSocket连接需要一个TCP连接。
HTTP升级协商  HTTP握手 Connection: Upgrade 跨域  性能 XHR轮询、SSE（EventSource协议）、WebSocket协议。
轮询有间隔时间，SSE客户端不能给服务端发消息，SSE和WebSocket都可以立即发消息。
实战 使用sockjs
使用stompjs
断线重连" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.wss.cool/docs/1.%E7%A8%8B%E5%BA%8F%E5%91%98/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/websocket/" />

<title>Web Socket | wss.cool</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e161f1fe2b283b6a43c29a52fde96e2387fade573e78efa6701d44c8499da76b.css" integrity="sha256-4WHx/isoO2pDwppS/eluI4f63lc&#43;eO&#43;mcB1EyEmdp2s=">
<script defer src="/en.search.min.5265c6f880b98bce38a6cac2079253a46af2959c1455d2afc076857e63ad1d6a.js" integrity="sha256-UmXG&#43;IC5i844psrCB5JTpGrylZwUVdKvwHaFfmOtHWo="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>wss.cool</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/0.%E5%89%8D%E7%AB%AF/" class="collapsed ">0.前端</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/1.%E7%A8%8B%E5%BA%8F%E5%91%98/" class="collapsed ">1.程序员</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <span>算法</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/1.%E7%A8%8B%E5%BA%8F%E5%91%98/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/" class="">排序</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <span>数据结构</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/1.%E7%A8%8B%E5%BA%8F%E5%91%98/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/hash%E8%A1%A8/" class="">Hash表</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <span>网络协议</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/1.%E7%A8%8B%E5%BA%8F%E5%91%98/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/tcp%E5%8D%8F%E8%AE%AE/" class="">T C P协议</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/1.%E7%A8%8B%E5%BA%8F%E5%91%98/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/websocket/" class="active">Web Socket</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <span>2.工程师</span>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/3.%E9%9D%A2%E8%AF%95/" class="collapsed ">3.面试</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/4.%E7%AC%94%E8%AE%B0/" class="collapsed ">4.笔记</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/docs/shortcodes/" class="collapsed ">Shortcodes</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/example/" class="collapsed ">Introduction</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="/posts/" >
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Web Socket</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#二进制的类型">二进制的类型</a></li>
    <li><a href="#排队">排队</a></li>
    <li><a href="#子协议">子协议</a></li>
    <li><a href="#协议">协议</a></li>
    <li><a href="#二进制分帧层">二进制分帧层</a></li>
    <li><a href="#http升级协商">HTTP升级协商</a></li>
    <li><a href="#性能">性能</a></li>
    <li><a href="#实战">实战</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="websocket">WebSocket</h1>
<p><strong>第一部分：WebSocket API</strong></p>
<h2 id="二进制的类型">二进制的类型</h2>
<p>WebSocket的消息可以是文本或者二进制数据，可以设置接收二进制数据的格式：Blob、ArrayBuffer。</p>
<ul>
<li>Blob是不可变的文件对象，适合直接保存、传给img</li>
<li>ArrayBuffer适合放在内存中进行操作</li>
</ul>
<p>二进制数据可以用于传输文件、图片。普通消息用文本。</p>
<h2 id="排队">排队</h2>
<p>发送消息前检查客户端缓冲的数据量。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">bufferedAmount</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
  <span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">message</span>);
}
</code></pre></div><p>消息按照客户端排队的顺序逐个发送，大量的消息甚至一个大消息，都会导致排在后面的消息延迟——队首阻塞！</p>
<h2 id="子协议">子协议</h2>
<p>通过使用子协议来沟通元数据，可以在JSON中定义一个字段，可以使用文本+二进制。</p>
<p>WebSocket提供了协商子协议的API——构造函数的第二个参数。浏览器选择一个协议，如果一个不选就会断开连接。</p>
<p><strong>第二部分：WebSocket协议</strong></p>
<h2 id="协议">协议</h2>
<p>HTTP握手协商连接参数，二进制消息分帧进行文本和二进制数据消息传输。</p>
<h2 id="二进制分帧层">二进制分帧层</h2>
<p>将一个消息分成若干帧，传输以帧为单位进行，发送到目的地后组成起来，等接收到完整的消息时再通知接收方。</p>
<p>容易发生队首阻塞，因为消息的帧不能交错发送，要等一个消息的帧发送完了才会发送下一个消息的帧。</p>
<p>不支持多路复用，每个WebSocket连接需要一个TCP连接。</p>
<h2 id="http升级协商">HTTP升级协商</h2>
<ul>
<li>HTTP握手</li>
<li>Connection: Upgrade</li>
<li>跨域</li>
</ul>
<h2 id="性能">性能</h2>
<p>XHR轮询、SSE（EventSource协议）、WebSocket协议。</p>
<p>轮询有间隔时间，SSE客户端不能给服务端发消息，SSE和WebSocket都可以立即发消息。</p>
<h2 id="实战">实战</h2>
<p>使用sockjs</p>
<p>使用stompjs</p>
<p>断线重连</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#二进制的类型">二进制的类型</a></li>
    <li><a href="#排队">排队</a></li>
    <li><a href="#子协议">子协议</a></li>
    <li><a href="#协议">协议</a></li>
    <li><a href="#二进制分帧层">二进制分帧层</a></li>
    <li><a href="#http升级协商">HTTP升级协商</a></li>
    <li><a href="#性能">性能</a></li>
    <li><a href="#实战">实战</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












